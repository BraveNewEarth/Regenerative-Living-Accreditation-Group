<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regenerative Living Accreditation Directory</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #edf9f9;
            min-height: 100vh;
        }

        .header {
            background: #004f5b;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjUiIGN5PSIyNSIgcj0iMjUiIGZpbGw9IiNlZGY5ZjkiLz4KPHN2ZyB4PSI4IiB5PSI4IiB3aWR0aD0iMzQiIGhlaWdodD0iMzQiIHZpZXdCb3g9IjAgMCAzNCAzNCIgZmlsbD0ibm9uZSI+Cjx0ZXh0IHg9IjE3IiB5PSIyMSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iIzAwNGY1YiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiPlJMQTwvdGV4dD4KPC9zdmc+Cjwvc3ZnPgo=') center/cover;
            border-radius: 50%;
        }

        .title {
            color: white;
            font-size: 24px;
            font-weight: 600;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .stats {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
        }

        .world-logo {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .directory-container {
            padding: 40px;
            min-height: calc(100vh - 80px);
            position: relative;
        }

        .node {
            position: absolute;
            width: 220px;
            cursor: grab;
            transition: all 0.3s ease;
            z-index: 10;
            text-align: center;
        }

        .node:hover {
            transform: scale(1.05);
        }

        .node:active {
            cursor: grabbing;
        }

        .node-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
            border: 3px solid white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
            background-size: cover;
            background-position: center;
            overflow: hidden;
        }

        .node-info {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border: 1px solid rgba(78, 205, 196, 0.2);
        }

        .node-name {
            font-weight: bold;
            color: #2c3e50;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .node-org {
            color: #7f8c8d;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .node-skills, .node-interests {
            margin-bottom: 8px;
        }

        .node-label {
            font-size: 11px;
            font-weight: bold;
            color: #34495e;
            margin-bottom: 3px;
        }

        .node-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 3px;
            justify-content: center;
        }

        .node-skill-tag {
            background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(78, 205, 196, 0.3);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .node-interest-tag {
            background: linear-gradient(135deg, #44A08D 0%, #2E7D6C 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(68, 160, 141, 0.3);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .connection {
            position: absolute;
            background: rgba(78, 205, 196, 0.3);
            height: 2px;
            transform-origin: left center;
            z-index: 1;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .header {
                padding: 10px 15px;
            }
            
            .title {
                font-size: 18px;
            }
            
            .node {
                width: 180px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo-section">
            <div class="logo"></div>
            <div class="title">Regenerative Living Accreditation Directory</div>
        </div>
        <div class="controls">
            <div class="stats">
                <span id="participantCount">3</span> participants â€¢ 
                <span id="connectionCount">0</span> connections
            </div>
            <div class="world-logo">5W</div>
        </div>
    </div>

    <div class="directory-container" id="directoryContainer">
        <!-- Participants will be loaded here -->
    </div>

    <script>
        // Simple data storage - reads from localStorage
        let participants = JSON.parse(localStorage.getItem('rla_participants') || '[{"id": 1, "name": "Bruce Weaver", "organization": "Regen 8", "linkedin": "https://www.linkedin.com/in/bruceweaverlandpropertymanager/", "profileImage": "picBruceWeaver.Headshot", "skills": "Estate Ranch Management, Grazing, Permaculture, Biochar Production", "interests": "Regenerative Leadership, Regenerative Grazing, Permaculture, Agroforestry, Silvopasture"}, {"id": 2, "name": "Brittany Mish", "organization": "5th World", "linkedin": "https://www.linkedin.com/in/brittany-mish-ab981aa4/", "profileImage": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCABgAGADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD3+iiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD//2Q==", "skills": "Organization, Research, Project Management, Portfolio Management, Microsoft Suite, Analytical Skills, Customer Service, Time Management", "interests": "Asset Optimization, Business Efficiency, Unconventional Organization, Helping Businesses, Human Asset Development"}, {"id": 3, "name": "Rob Avis", "organization": "5th World (Chief Engineering Officer)", "linkedin": "https://www.linkedin.com/in/rob-avis-09b5a2281/", "profileImage": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCADgAOADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD3+iiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD//2Q==", "skills": "Permaculture Design, Regenerative Agriculture, Water Systems Design, Broad Acre Water Harvesting, Irrigation Engineering, Passive Solar Greenhouse Design, Renewable Energy Systems, Low Energy Consumption Systems, Thermo and Fluid Dynamics, Biology Integration, Land Management, Mechanical Engineering, Ecosystem Design, Education", "interests": "Land Regeneration, Sustainable Food Production, Renewable Energy, Water Security, Ecosystem Complexity, Multi-generational Farming, Regenerative Farm Design, Integrating Engineering and Biology, Teaching Regenerative Practices"}]');

        let draggedNode = null;

        // Initialize the application
        function init() {
            loadAllParticipants();
            updateStats();
            calculateConnections();
        }

        // Load all participants from localStorage and render them
        function loadAllParticipants() {
            const container = document.getElementById('directoryContainer');
            container.innerHTML = ''; // Clear existing nodes
            
            if (participants.length === 0) {
                container.innerHTML = `
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #7f8c8d;">
                        <div style="font-size: 48px; margin-bottom: 20px;">ðŸŒ±</div>
                        <div style="font-size: 24px; margin-bottom: 10px;">No participants yet</div>
                        <div>Access the admin panel to add participants</div>
                    </div>
                `;
                return;
            }

            participants.forEach((participant, index) => {
                renderParticipantNode(participant, index);
            });
        }

        // Render a single participant node
        function renderParticipantNode(participant, index) {
            const container = document.getElementById('directoryContainer');
            const nodeId = participant.id === 1 ? 'bruceNode' : `node-${participant.id}`;
            
            // Get initials for fallback
            const initials = participant.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
            
            // Split skills and interests
            const skills = participant.skills.split(',').map(s => s.trim()).filter(s => s).slice(0, 4);
            const interests = participant.interests.split(',').map(s => s.trim()).filter(s => s).slice(0, 4);
            
            // Position calculation
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;
            const radius = Math.min(centerX, centerY) * 0.4;
            const angle = (index / participants.length) * 2 * Math.PI;
            const x = centerX + radius * Math.cos(angle) - 110;
            const y = centerY + radius * Math.sin(angle) - 100;
            
            const nodeHTML = `
                <div class="node" style="left: ${x}px; top: ${y}px;" id="${nodeId}">
                    <div class="node-image" ${participant.profileImage ? `style="background-image: url('${participant.profileImage}')"` : ''}>
                        ${!participant.profileImage ? initials : ''}
                    </div>
                    <div class="node-info">
                        <div class="node-name">${participant.name}</div>
                        <div class="node-org">${participant.organization || ''}</div>
                        <div class="node-skills">
                            <div class="node-label">Skills</div>
                            <div class="node-tags">
                                ${skills.map(skill => `<span class="node-skill-tag">${skill}</span>`).join('')}
                            </div>
                        </div>
                        <div class="node-interests">
                            <div class="node-label">Interests</div>
                            <div class="node-tags">
                                ${interests.map(interest => `<span class="node-interest-tag">${interest}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', nodeHTML);
            const newNode = document.getElementById(nodeId);
            makeDraggable(newNode);
        }

        // Add drag functionality to any node
        function makeDraggable(element) {
            let isDragging = false;
            let startX, startY, initialX, initialY;
            
            element.addEventListener('mousedown', (e) => {
                isDragging = true;
                draggedNode = element;
                startX = e.clientX;
                startY = e.clientY;
                initialX = element.offsetLeft;
                initialY = element.offsetTop;
                
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseUp);
                
                e.preventDefault();
            });
            
            function handleMouseMove(e) {
                if (isDragging && draggedNode === element) {
                    const deltaX = e.clientX - startX;
                    const deltaY = e.clientY - startY;
                    
                    element.style.left = (initialX + deltaX) + 'px';
                    element.style.top = (initialY + deltaY) + 'px';
                    
                    // Update connections in real-time
                    calculateConnections();
                }
            }
            
            function handleMouseUp() {
                isDragging = false;
                draggedNode = null;
                document.removeEventListener('mousemove', handleMouseMove);
                document.removeEventListener('mouseup', handleMouseUp);
            }
        }

        // Update stats
        function updateStats() {
            document.getElementById('participantCount').textContent = participants.length;
        }

        // Calculate connections between nodes
        function calculateConnections() {
            const container = document.getElementById('directoryContainer');
            
            // Remove existing connections
            container.querySelectorAll('.connection').forEach(conn => conn.remove());
            
            let connectionCount = 0;
            
            // Create connections between nodes with shared skills/interests
            for (let i = 0; i < participants.length; i++) {
                for (let j = i + 1; j < participants.length; j++) {
                    const p1 = participants[i];
                    const p2 = participants[j];
                    
                    const skills1 = p1.skills.toLowerCase().split(',').map(s => s.trim()).filter(s => s);
                    const skills2 = p2.skills.toLowerCase().split(',').map(s => s.trim()).filter(s => s);
                    const interests1 = p1.interests.toLowerCase().split(',').map(s => s.trim()).filter(s => s);
                    const interests2 = p2.interests.toLowerCase().split(',').map(s => s.trim()).filter(s => s);
                    
                    const sharedSkills = skills1.filter(skill => skills2.includes(skill));
                    const sharedInterests = interests1.filter(interest => interests2.includes(interest));
                    
                    if (sharedSkills.length > 0 || sharedInterests.length > 0) {
                        const node1Id = p1.id === 1 ? 'bruceNode' : `node-${p1.id}`;
                        const node2Id = p2.id === 1 ? 'bruceNode' : `node-${p2.id}`;
                        
                        const node1 = document.getElementById(node1Id);
                        const node2 = document.getElementById(node2Id);
                        
                        if (node1 && node2) {
                            createConnection(node1, node2, [...sharedSkills, ...sharedInterests]);
                            connectionCount++;
                        }
                    }
                }
            }
            
            document.getElementById('connectionCount').textContent = connectionCount;
        }

        // Create visual connection between two nodes
        function createConnection(node1, node2, shared) {
            const container = document.getElementById('directoryContainer');
            const rect1 = node1.getBoundingClientRect();
            const rect2 = node2.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            const x1 = rect1.left - containerRect.left + rect1.width / 2;
            const y1 = rect1.top - containerRect.top + rect1.height / 2;
            const x2 = rect2.left - containerRect.left + rect2.width / 2;
            const y2 = rect2.top - containerRect.top + rect2.height / 2;
            
            const distance = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
            const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
            
            const connection = document.createElement('div');
            connection.className = 'connection';
            connection.style.left = x1 + 'px';
            connection.style.top = y1 + 'px';
            connection.style.width = distance + 'px';
            connection.style.transform = `rotate(${angle}deg)`;
            connection.title = `Shared: ${shared.join(', ')}`;
            
            container.appendChild(connection);
        }

        // Auto-refresh data every 5 seconds to sync with admin changes
        setInterval(() => {
            const newData = localStorage.getItem('rla_participants');
            if (newData) {
                const newParticipants = JSON.parse(newData);
                if (JSON.stringify(newParticipants) !== JSON.stringify(participants)) {
                    participants = newParticipants;
                    loadAllParticipants();
                    updateStats();
                    calculateConnections();
                }
            }
        }, 5000);

        // Initialize app when page loads
        window.addEventListener('load', init);
        window.addEventListener('resize', () => {
            setTimeout(() => {
                loadAllParticipants();
                calculateConnections();
            }, 100);
        });
    </script>
</body>
</html>
